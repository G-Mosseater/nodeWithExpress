<%- include('../includes/head', { pageTitle: pageTitle, stylesheet: '/product.css' }) %>
    </head>

    <body class="body">

        <%- include('../includes/navigation', { path: path }) %>

            <main class="main">
                <h1>Checkout</h1>

                <% if (products && products.length> 0) { %>

                    <div class="product-list">

                        <% products.forEach(item=> { %>
                            <div class="product-card">

                                <h2 class="product-card__title">
                                    <%= item.product.title %>
                                </h2>

                                <img src="/<%= item.product.imageUrl %>" alt="<%= item.product.title %>"
                                    class="product-card__img">

                                <p class="product-card__description">
                                    <%= item.product.description %>
                                </p>

                                <p>Price: $<%= item.product.price %> Ã— <%= item.quantity %>
                                </p>

                                <p>Subtotal: $<%= (item.product.price * item.quantity).toFixed(2) %>
                                </p>

                            </div>
                            <% }) %>

                    </div>

                    <section class="checkout-summary">
                        <h2>Total: $<%= totalSum %>
                        </h2>

                        <!-- Stripe Checkout Button -->
                        <button id="order-btn" style="
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            margin: 1rem auto;
          ">
                            Pay with Stripe
                        </button>

                        <input type="hidden" id="sessionId" value="<%= sessionId %>">
                    </section>

                    <% } else { %>
                        <p>Your cart is empty.</p>
                        <% } %>

            </main>
            <script src="https://js.stripe.com/v3/"></script>
            <script>
                const stripe = Stripe("<%= publicKey %>");

                document.getElementById("order-btn").addEventListener('click', () => {
                    stripe.redirectToCheckout({
                        sessionId: "<%= sessionId %>"
                    })
                })
            </script>


            <%- include('../includes/end') %>

    </body>

    </html>